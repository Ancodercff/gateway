<div class="row wrapper border-bottom white-bg page-heading">
  <div class="col-lg-12">
    <h2>用户密钥列表</h2>
    <ol class="breadcrumb">
      <li><a>用户信息</a></li>
      <li class="active"><b>密钥列表</b></li>
    </ol>
  </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
  <div class="row">
    <div class="col-lg-12">
      <div class="ibox">
        <div class="ibox-content" id="ltstableContainer">
          <form class="form-horizontal" action="/user/applyKey" method="post">
            <input id="csrfToken" type="hidden" name="csrfToken"
                   value="$csrfTool.getToken($request)"/>
            <input type="hidden" name="userId" value="$!loginUser.userIdentity">
            <table class="table table-bordered table-striped">
              <thead>
              <tr>
                <th>ID</th>
                <th>密钥</th>
                <th>申请时间</th>
                <th>操作</th>
              </tr>
              </thead>
              <tbody>
                  #if (! $keyList)
                  <tr>
                    <td colspan="4">还未有Key</td>
                  </tr>
                  #else
                      #foreach($key in $keyList)
                      <tr>
                        <td>$key.id</td>
                        <td>$key.key</td>
                        <td>$key.created_at</td>
                        <td><a href="/user/deleteKey/$key.id">删除</a></td>
                      </tr>
                      #end
                  #end
              </tbody>
            </table>
            <div class="hr-line-dashed"></div>
            <div class="form-group">
              <div class="col-sm-1 col-sm-offset-2" style="width:70px;">
                <button class="btn btn-primary" type="submit" id="addBtn">
                  申请 Key
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $("form").on('submit', function(event) {
    event.preventDefault();
    $.ajax({
      url: $(this).attr("action"),
      type: 'POST',
      dataType: 'json',
      data: $(this).serialize(),
      success: function (json) {
        if (json && json.success) {
          location.href = "/user/keyList";
        } else {
          json ? swal(json['msg'], "", "error") : {};
        }
      }
    });
  });
</script>
